---
# GitLab SSO Configuration via Keycloak OIDC

# GitLab container configuration
gitlab_sso_container_id: 153
gitlab_sso_hostname: "gitlab"
gitlab_sso_ip_address: "172.16.10.153"
gitlab_sso_external_domain: "viljo.se"
gitlab_sso_public_url: "https://gitlab.viljo.se"

# Keycloak configuration
gitlab_sso_keycloak_container_id: 151
gitlab_sso_keycloak_hostname: "keycloak"
gitlab_sso_keycloak_ip_address: "172.16.10.151"
gitlab_sso_keycloak_port: 8080
gitlab_sso_keycloak_realm: "master"
gitlab_sso_keycloak_public_url: "https://keycloak.viljo.se"
gitlab_sso_keycloak_internal_url: "http://172.16.10.151:8080"

# Keycloak admin credentials
gitlab_sso_keycloak_admin_user: "admin"
gitlab_sso_keycloak_admin_password: "{{ vault_keycloak_admin_password }}"

# GitLab OIDC client configuration
gitlab_sso_client_id: "gitlab"
gitlab_sso_client_secret: "{{ vault_gitlab_oidc_client_secret | default('generated_at_runtime') }}"
gitlab_sso_client_description: "GitLab OIDC Client"

# OIDC provider configuration for GitLab
gitlab_sso_provider_name: "openid_connect"
gitlab_sso_provider_label: "Keycloak SSO"
gitlab_sso_discovery_enabled: true

# OIDC discovery endpoint
gitlab_sso_issuer: "{{ gitlab_sso_keycloak_public_url }}/realms/{{ gitlab_sso_keycloak_realm }}"

# OIDC scopes
gitlab_sso_scopes:
  - "openid"
  - "profile"
  - "email"

# User attribute mapping
gitlab_sso_uid_field: "preferred_username"

# Redirect URI for GitLab
gitlab_sso_redirect_uri: "{{ gitlab_sso_public_url }}/users/auth/openid_connect/callback"

# GitLab OmniAuth settings
gitlab_sso_allow_single_sign_on: true
gitlab_sso_block_auto_created_users: false
gitlab_sso_auto_link_ldap_user: false
gitlab_sso_auto_link_saml_user: false

# GitLab root password (for configuration access)
gitlab_sso_root_password: "{{ vault_gitlab_container_root_password }}"

# GitLab configuration file (host path, mounted to /etc/gitlab in container)
gitlab_config_file: "/opt/gitlab/config/gitlab.rb"
