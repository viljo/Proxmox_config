---
# Backup Manifest
# Generated: {{ ansible_date_time.iso8601 }}

backup_info:
  timestamp: {{ backup_timestamp }}
  date: {{ ansible_date_time.date }}
  time: {{ ansible_date_time.time }}
  timezone: {{ ansible_date_time.tz }}
  hostname: {{ ansible_hostname }}
  operator: automated

containers:
{% for container in backup_containers %}
{% if container.enabled | default(true) %}
  - id: {{ container.id }}
    name: {{ container.name }}
    compressed: {{ container.compress | default(true) }}
    storage: {{ backup_storage }}
{% endif %}
{% endfor %}

postgresql:
  enabled: {{ backup_postgresql_enabled }}
  host: {{ backup_postgresql_host }}
  port: {{ backup_postgresql_port }}
  databases:
{% for db in backup_postgresql_databases %}
    - {{ db }}
{% endfor %}

redis:
  enabled: {{ backup_redis_enabled }}
  host: {{ backup_redis_host }}
  container_id: {{ backup_redis_container_id }}

docker_volumes:
  enabled: {{ backup_docker_volumes_enabled }}
  containers:
{% for container in backup_docker_containers %}
    - id: {{ container.container_id }}
      name: {{ container.name }}
      volumes:
{% for volume in container.volumes %}
        - {{ volume }}
{% endfor %}
{% endfor %}

configuration_files:
  enabled: {{ backup_proxmox_configs_enabled }}
  paths:
{% for path in backup_proxmox_configs %}
    - {{ path }}
{% endfor %}

retention:
  daily: {{ backup_retention_daily }} days
  weekly: {{ backup_retention_weekly }} weeks
  monthly: {{ backup_retention_monthly }} months

remote_backup:
  enabled: {{ backup_remote_enabled }}
{% if backup_remote_enabled %}
  host: {{ backup_remote_host }}
  path: {{ backup_remote_path }}
{% endif %}
