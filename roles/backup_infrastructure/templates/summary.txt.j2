================================================================================
INFRASTRUCTURE BACKUP SUMMARY
================================================================================

Backup Timestamp: {{ backup_timestamp }}
Date: {{ ansible_date_time.date }} {{ ansible_date_time.time }} {{ ansible_date_time.tz }}
Hostname: {{ ansible_hostname }}
Operator: Automated via Ansible

================================================================================
CONTAINERS
================================================================================

{% for container in backup_containers %}
{% if container.enabled | default(true) %}
[{{ container.id }}] {{ container.name }}
  Status: BACKED UP
  Storage: {{ backup_storage }}
  Compression: {{ 'zstd' if container.compress | default(true) else 'none' }}
{% endif %}
{% endfor %}

Total containers backed up: {{ backup_containers | selectattr('enabled', 'equalto', true) | list | length }}

================================================================================
POSTGRESQL DATABASES
================================================================================

{% if backup_postgresql_enabled %}
Host: {{ backup_postgresql_host }}:{{ backup_postgresql_port }}

{% for db in backup_postgresql_databases %}
- {{ db }}
  File: {{ db }}_{{ backup_timestamp }}.dump
{% endfor %}

Total databases backed up: {{ backup_postgresql_databases | length }}
{% else %}
PostgreSQL backup: DISABLED
{% endif %}

================================================================================
REDIS
================================================================================

{% if backup_redis_enabled %}
Host: {{ backup_redis_host }}
Container: {{ backup_redis_container_id }}
File: redis_{{ backup_timestamp }}.rdb
Status: BACKED UP
{% else %}
Redis backup: DISABLED
{% endif %}

================================================================================
DOCKER VOLUMES
================================================================================

{% if backup_docker_volumes_enabled %}
{% for container in backup_docker_containers %}
[{{ container.container_id }}] {{ container.name }}
{% for volume in container.volumes %}
  - {{ volume }}
    File: {{ container.name }}_{{ volume | basename }}_{{ backup_timestamp }}.tar.gz
{% endfor %}
{% endfor %}

Total volumes backed up: {{ backup_docker_containers | sum(attribute='volumes', start=[]) | length }}
{% else %}
Docker volumes backup: DISABLED
{% endif %}

================================================================================
CONFIGURATION FILES
================================================================================

{% if backup_proxmox_configs_enabled %}
Archive: proxmox-configs_{{ backup_timestamp }}.tar.gz
Includes:
{% for path in backup_proxmox_configs %}
  - {{ path }}
{% endfor %}
{% else %}
Configuration backup: DISABLED
{% endif %}

================================================================================
RETENTION POLICY
================================================================================

Daily backups: {{ backup_retention_daily }} days
Weekly backups: {{ backup_retention_weekly }} weeks
Monthly backups: {{ backup_retention_monthly }} months

================================================================================
REMOTE BACKUP
================================================================================

{% if backup_remote_enabled %}
Status: ENABLED
Destination: {{ backup_remote_user }}@{{ backup_remote_host }}:{{ backup_remote_path }}
{% else %}
Status: DISABLED
{% endif %}

================================================================================
BACKUP LOCATION
================================================================================

{{ backup_base_dir }}/{{ backup_timestamp }}/

Contents:
  - MANIFEST.yml (this backup's metadata)
  - BACKUP_SUMMARY.txt (this file)
  - containers/ (LXC container backups via Proxmox)
  - postgresql/ (PostgreSQL database dumps)
  - docker-volumes/ (Docker volume archives)
  - configs/ (Proxmox configuration archives)

================================================================================
RESTORATION NOTES
================================================================================

1. Container Restoration:
   pct restore <NEW_VMID> <BACKUP_FILE> --storage <STORAGE>

2. PostgreSQL Restoration:
   PGPASSWORD='password' pg_restore -h host -U user -d dbname backup.dump

3. Docker Volume Restoration:
   tar xzf volume_backup.tar.gz -C /destination/path

4. Configuration Restoration:
   tar xzf proxmox-configs_*.tar.gz -C /

For detailed restoration procedures, see: docs/operations/disaster-recovery.md

================================================================================
END OF BACKUP SUMMARY
================================================================================
