---
# Playbook: Deploy GitLab Runner
# Description: Deploy GitLab runner for gitlab.com projects

- name: Deploy GitLab Runner
  hosts: proxmox_admin
  gather_facts: false

  vars:
    public_domain: viljo.se
    lxc_id: 200

  pre_tasks:
    - name: Display deployment plan
      ansible.builtin.debug:
        msg:
          - "=========================================="
          - "GitLab Runner Configuration"
          - "=========================================="
          - "This playbook will configure runner with:"
          - "  - 6 concurrent jobs"
          - "  - Image caching (pull_policy: if-not-present)"
          - "  - Target: gitlab.com"
          - "=========================================="

  tasks:
    - name: Deploy GitLab Runner
      ansible.builtin.include_role:
        name: gitlab_runners

  post_tasks:
    - name: Display status
      ansible.builtin.debug:
        msg:
          - "=========================================="
          - "GitLab Runner Configuration Complete"
          - "=========================================="
          - ""
          - "Runner: ViktorToreRudolf"
          - "Concurrent jobs: 6"
          - "Image caching: enabled"
          - ""
          - "Verify with:"
          - "  pct exec 200 -- docker exec gitlab-runner gitlab-runner list"
          - "=========================================="
